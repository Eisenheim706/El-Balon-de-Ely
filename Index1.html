<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>El Balc√≥n de Ely</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    :root {
      --color-principal: #fcbf49;
      --color-acento: #d62828;
      --color-fondo: #fffdf9;
    }
    * {
      box-sizing: border-box;
      scroll-behavior: smooth;
    }
    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background-color: var(--color-fondo);
      color: #333;
    }
    img {
      max-width: 100%;
      display: block;
    }
    a, button {
      transition: 0.3s ease all;
    }

    /* Responsive Utility */
    @media (max-width: 768px) {
      h1 { font-size: 2.2em; }
      .hero a, .producto button, #confirmar-pedido, #ver-todo button {
        width: 100%;
        display: block;
      }
      .producto input {
        width: 100%;
      }
    }
  </style>
</head>
<body>

<header class="hero" style="background: url('img/portada1.jpg') center center/cover no-repeat; height: 90vh; display: flex; justify-content: center; align-items: center; flex-direction: column; position: relative; color: white;">
  <div style="position: absolute; width:100%; height:100%; top:0; left:0; background-color: rgba(0,0,0,0.45); z-index:1;"></div>
  <h1 style="z-index:2; font-size:3em; text-shadow:1px 1px 4px #000;">El Balc√≥n de Ely</h1>
  <a href="#menu" style="z-index:2; background: var(--color-principal); padding: 12px 24px; border-radius: 6px; text-decoration: none; color: black; font-weight: bold;">Ver men√∫</a>
</header>

<section id="menu" style="padding: 60px 20px; max-width: 1100px; margin: auto;">
  <h2 style="text-align: center; font-size: 2em; color: var(--color-acento); margin-bottom: 40px;">üçΩÔ∏è Platos destacados</h2>
  <div class="menu-grid" style="display: grid; gap: 30px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
    <div class="producto" style="background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
      <img src="img/pizza.jpeg" alt="Pizza de Queso" style="height: 180px; object-fit: cover; border-radius: 6px;">
      <h3 style="color: var(--color-acento); margin-top: 10px;">Pizza de Queso</h3>
      <p>Precio: 180 CUP</p>
      <input type="number" min="1" value="1" id="qty-pizza" style="margin-top: 8px; width: 60px;">
      <button onclick="addToCart('Pizza de Queso', 180, 'qty-pizza')" style="margin-top: 12px; background: var(--color-acento); color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">Agregar</button>
    </div>

    <div class="producto">
      <img src="img/batido.jpeg" alt="Batido de Mango" style="height: 180px; object-fit: cover; border-radius: 6px;">
      <h3 style="color: var(--color-acento); margin-top: 10px;">Batido de Mango</h3>
      <p>Precio: 60 CUP</p>
      <input type="number" min="1" value="1" id="qty-batido" style="margin-top: 8px; width: 60px;">
      <button onclick="addToCart('Batido de Mango', 60, 'qty-batido')" style="margin-top: 12px; background: var(--color-acento); color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">Agregar</button>
    </div>

    <div class="producto">
      <img src="img/cerveza.jpeg" alt="Cerveza" style="height: 180px; object-fit: cover; border-radius: 6px;">
      <h3 style="color: var(--color-acento); margin-top: 10px;">Cerveza</h3>
      <p>Precio: 200 CUP</p>
      <input type="number" min="1" value="1" id="qty-cerveza" style="margin-top: 8px; width: 60px;">
      <button onclick="addToCart('Cerveza', 200, 'qty-cerveza')" style="margin-top: 12px; background: var(--color-acento); color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;">Agregar</button>
    </div>
  </div>

  <div id="ver-todo" style="text-align: center; margin-top: 30px;">
    <button onclick="alert('Pr√≥ximamente m√°s productos disponibles üòã')" style="background: var(--color-principal); color: black; font-weight: bold; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer;">Ver men√∫ completo</button>
  </div>

  <div id="carrito" style="background: #fff4da; padding: 20px; border-radius: 10px; margin-top: 40px;">
    <h3>üõí Tu pedido</h3>
    <ul id="cart-list" style="padding-left: 20px;"></ul>
    <p><strong>Total:</strong> <span id="cart-total">0</span> CUP</p>
  </div>
</section>

<!-- Bot√≥n flotante de WhatsApp -->
<a id="btn-whatsapp" href="#" target="_blank" style="position: fixed; bottom: 20px; right: 20px; background: #25d366; color: white; font-weight: bold; padding: 14px 20px; border-radius: 50px; display: none; align-items: center; gap: 10px; text-decoration: none; box-shadow: 0 2px 6px rgba(0,0,0,0.2); z-index: 100;">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" style="width: 22px; height: 22px;">
  Pedir por WhatsApp
</a>
<!-- Leaflet.js (antes del </body>) -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<section id="delivery" style="padding: 60px 20px; max-width: 1100px; margin: auto;">
  <h2 style="text-align:center; color:#d62828;">üöö Servicio a domicilio</h2>
  <div id="map" style="height: 350px; border-radius: 10px; margin-bottom: 20px;"></div>
  <p>üìç Haz clic en el mapa para marcar tu ubicaci√≥n. Se calcular√° la distancia y el precio del delivery autom√°ticamente.</p>
  <p><strong>Distancia estimada:</strong> <span id="distancia">0</span> km</p>
  <p><strong>Precio de entrega (50 CUP/km):</strong> <span id="precio">0</span> CUP</p>
  <p><strong>Total del pedido:</strong> <span id="total-con-envio">0</span> CUP</p>
  <button id="confirmar-pedido" style="margin-top: 20px; background:#25d366; color:white; padding: 12px 20px; border:none; border-radius: 6px; font-weight: bold; cursor: pointer;">
    Confirmar pedido por WhatsApp
  </button>
</section>
<script>
  const puntoVenta = { lat: 22.401355, lng: -79.970718 };
  const precioPorKm = 50;
  let destinoCliente = null;
  let carrito = [];

  // A√±adir producto al carrito
  function addToCart(nombre, precio, inputId) {
    const cantidad = parseInt(document.getElementById(inputId).value);
    if (!cantidad || cantidad <= 0) return;

    const existente = carrito.find(p => p.nombre === nombre);
    if (existente) {
      existente.cantidad += cantidad;
    } else {
      carrito.push({ nombre, precio, cantidad });
    }

    actualizarCarrito();
    mostrarBotonWhatsApp();
    sincronizarConEntrega();
  }

  function actualizarCarrito() {
    const lista = document.getElementById("cart-list");
    lista.innerHTML = "";
    let total = 0;

    carrito.forEach(item => {
      const li = document.createElement("li");
      li.textContent = `${item.nombre} x${item.cantidad} ‚Äì ${item.precio * item.cantidad} CUP`;
      lista.appendChild(li);
      total += item.precio * item.cantidad;
    });

    document.getElementById("cart-total").textContent = total;
  }

  function mostrarBotonWhatsApp() {
    const btn = document.getElementById("btn-whatsapp");
    btn.style.display = carrito.length > 0 ? "flex" : "none";

    if (carrito.length > 0) {
      const total = carrito.reduce((sum, item) => sum + item.precio * item.cantidad, 0);
      let mensaje = "¬°Hola! Quisiera hacer este pedido:%0A";
      carrito.forEach(item => {
        mensaje += `- ${item.nombre} x${item.cantidad} (${item.precio * item.cantidad} CUP)%0A`;
      });
      mensaje += `%0ATotal: ${total} CUP`;
      const numero = "5354776437";
      const url = `https://wa.me/${numero}?text=${mensaje}`;
      btn.href = url;
    }
  }

  // M√≥dulo de entrega
  let totalProductos = 0;

  function distanciaKm(coord1, coord2) {
    const R = 6371;
    const dLat = (coord2.lat - coord1.lat) * Math.PI / 180;
    const dLon = (coord2.lng - coord1.lng) * Math.PI / 180;
    const a =
      Math.sin(dLat / 2) ** 2 +
      Math.cos(coord1.lat * Math.PI / 180) * Math.cos(coord2.lat * Math.PI / 180) *
      Math.sin(dLon / 2) ** 2;
    return (R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))).toFixed(2);
  }

  function sincronizarConEntrega() {
    totalProductos = carrito.reduce((t, item) => t + item.precio * item.cantidad, 0);
    calcularEntrega();
  }

  function calcularEntrega() {
    if (!destinoCliente) return;
    const km = parseFloat(distanciaKm(puntoVenta, destinoCliente));
    const precioDelivery = Math.round(km * precioPorKm);
    const total = totalProductos + precioDelivery;

    document.getElementById('distancia').textContent = km;
    document.getElementById('precio').textContent = precioDelivery;
    document.getElementById('total-con-envio').textContent = total;
  }

  document.getElementById('confirmar-pedido').addEventListener('click', () => {
    if (!destinoCliente || carrito.length === 0) {
      alert('Debes seleccionar una ubicaci√≥n y tener productos en el carrito.');
      return;
    }

    const km = parseFloat(distanciaKm(puntoVenta, destinoCliente));
    const precioDelivery = Math.round(km * precioPorKm);
    const total = totalProductos + precioDelivery;

    let mensaje = `Hola! Quiero confirmar este pedido:%0A`;
    carrito.forEach(p => {
      mensaje += `- ${p.nombre} x${p.cantidad} (${p.precio * p.cantidad} CUP)%0A`;
    });
    mensaje += `üëâ Distancia estimada: ${km} km%0A`;
    mensaje += `üì¶ Delivery: ${precioDelivery} CUP%0A`;
    mensaje += `üí∞ Total: ${total} CUP%0A`;
    mensaje += `üìç Ubicaci√≥n: https://www.google.com/maps?q=${destinoCliente.lat},${destinoCliente.lng}`;

    const adminPhone = "5354776437";
    const link = `https://wa.me/${adminPhone}?text=${mensaje}`;
    window.open(link, '_blank');
  });

  // Inicializar mapa
  const map = L.map('map').setView([22.401355, -79.970718], 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  let marker = null;
  map.on('click', e => {
    if (marker) map.removeLayer(marker);
    marker = L.marker(e.latlng).addTo(map);
    destinoCliente = e.latlng;
    calcularEntrega();
  });
</script>
</body>
</html>